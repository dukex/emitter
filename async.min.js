(function(c){function a(){var g=null;var f=c.emitter();var k=[];var j="rejected";var i="resolved";var e="always";var h="progress";var p=["fail","done","progress","when","isResolved","isRejected","isFrozen"];var l=function(s,q,r){if(r){throw new Error("Can't change state of frozen deferred")}g=s;k=Array.prototype.slice.apply(q);o(e,k);o(g,k)};var o=function(r,q){q=Array.prototype.slice.apply(q);f.emit.apply(f,[r].concat(q))};function n(){}function m(){}n.prototype.promise=function(){var q=this,u=new m(),s=0,r;var t=function(v){return function(){return q[v].apply(q,Array.prototype.slice.apply(arguments))}};for(;s<p.length;s++){r=p[s];u[r]=t(r)}return u};n.prototype.isRejected=function(){return g===j};n.prototype.isResolved=function(){return g===i};n.prototype.isFrozen=function(){return !!g};n.prototype.done=function(r,q){f.once(i,r,q);if(this.isResolved()){o(i,k)}return this};n.prototype.fail=function(r,q){f.once(j,r,q);if(this.isRejected()){o(j,k)}return this};n.prototype.always=function(r,q){f.once(e,r,q);if(this.isFrozen()){o(e,k)}return this};n.prototype.progress=function(r,q){if(this.isFrozen()){return}f.on(h,r,q);return this};n.prototype.resolve=function(){l(i,arguments,this.isFrozen())};n.prototype.reject=function(){l(j,arguments,this.isFrozen())};n.prototype.notify=function(){if(this.isFrozen()){return}o(h,arguments)};return new n()}function d(){var l=Array.prototype.slice.apply(arguments),h=[],k=arguments.length,g=0,e=c.defer(),j;var i=function(m){return function(){if(arguments.length<=1){h.push(arguments[0])}else{h.push(Array.prototype.slice.apply(arguments))}if(h.length===k&&!e.isFrozen()){e.resolve.apply(e,h)}}};var f=function(m){return function(){if(!e.isFrozen()){e.reject.apply(e,arguments)}}};for(;g<k;g++){j=l[g];if(j.done&&j.fail){j.done(i(g)).fail(f(g))}else{c.defer().done(i(g)).resolve(j)}}return e.promise()}function b(){var e={};function f(){}f.prototype.on=function(h,j,g,i){if(!e[h]){e[h]=[]}i=i||{};i.callback=j;i.context=g;e[h].push(i);return this};f.prototype.once=function(h,i,g){this.on(h,i,g,{once:true})};f.prototype.emit=function(){var h=Array.prototype.slice.apply(arguments),j=h.shift(),g,i,j;if(!e[j]){return}g=0;i=e[j].length;e[j]=e[j].filter(function(k){k.callback.apply(k.context,h);if(!k.once){return k}})};return new f()}c.defer=a;c.when=d;c.emitter=b})(typeof(exports)==="undefined"?this["async"]={}:exports);